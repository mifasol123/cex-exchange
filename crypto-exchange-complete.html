<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEX - 企业级加密货币交易所完整演示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .feature-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .trade-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .progress-step {
            transition: all 0.3s ease;
        }
        .progress-step.active {
            background: #667eea;
            color: white;
        }
        .kyc-step {
            display: none;
        }
        .kyc-step.active {
            display: block;
        }
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        .metric-card {
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border: 1px solid #e2e8f0;
        }
        .dark .metric-card {
            background: linear-gradient(145deg, #1e293b, #334155);
            border: 1px solid #475569;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- 数据源状态指示器 -->
    <div id="dataSourceBanner" class="bg-blue-600 text-white text-center py-2 text-sm">
        <span id="dataSourceText">数据源: 正在连接...</span>
    </div>

    <!-- 错误提示层 -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- 导航栏 -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold gradient-bg bg-clip-text text-transparent">CEX Exchange</h1>
                    </div>
                    <div class="hidden md:ml-6 md:flex md:space-x-8">
                        <button onclick="showTab('trading')" class="nav-link text-gray-900 dark:text-white hover:text-blue-600 px-3 py-2 text-sm font-medium">交易</button>
                        <button onclick="showTab('login')" class="nav-link text-gray-500 hover:text-gray-700 dark:text-gray-300 px-3 py-2 text-sm font-medium">登录</button>
                        <button onclick="showTab('kyc')" class="nav-link text-gray-500 hover:text-gray-700 dark:text-gray-300 px-3 py-2 text-sm font-medium">KYC验证</button>
                        <button onclick="showTab('dashboard')" class="nav-link text-gray-500 hover:text-gray-700 dark:text-gray-300 px-3 py-2 text-sm font-medium">用户中心</button>
                        <button onclick="showTab('admin')" class="nav-link text-gray-500 hover:text-gray-700 dark:text-gray-300 px-3 py-2 text-sm font-medium">管理后台</button>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="toggleTheme()" class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-300">
                        <i data-lucide="sun" class="w-5 h-5 dark:hidden"></i>
                        <i data-lucide="moon" class="w-5 h-5 hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <!-- 交易界面 -->
        <div id="trading-tab" class="tab-content active">
    <div class="mb-6">
        <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">超越币安OKX的下一代交易所</h2>
        <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mt-4">
            <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-3 rounded-lg text-center">
                <div class="text-sm font-medium">撮合延迟</div>
                <div class="text-xl font-bold">10纳秒</div>
                <div class="text-xs opacity-90">FPGA硬件加速</div>
            </div>
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-3 rounded-lg text-center">
                <div class="text-sm font-medium">峰值TPS</div>
                <div class="text-xl font-bold">1亿</div>
                <div class="text-xs opacity-90">RDMA零拷贝</div>
            </div>
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-3 rounded-lg text-center">
                <div class="text-sm font-medium">做市商费率</div>
                <div class="text-xl font-bold">-0.05%</div>
                <div class="text-xs opacity-90">交易即赚钱</div>
            </div>
            <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-3 rounded-lg text-center">
                <div class="text-sm font-medium">AI交易助手</div>
                <div class="text-xl font-bold">GPT-4</div>
                <div class="text-xs opacity-90">对话式下单</div>
            </div>
            <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-3 rounded-lg text-center">
                <div class="text-sm font-medium">机构服务</div>
                <div class="text-xl font-bold">暗池</div>
                <div class="text-xs opacity-90">大宗交易网络</div>
            </div>
            <div class="bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-3 rounded-lg text-center">
                <div class="text-sm font-medium">量子安全</div>
                <div class="text-xl font-bold">后量子</div>
                <div class="text-xs opacity-90">抗量子攻击</div>
            </div>
        </div>
        <p class="text-gray-600 dark:text-gray-400 mt-4">银行级安全 • 微秒级撮合 • AI智能风控 • 负费率奖励</p>
    </div>

            <!-- 交易对选择器 -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="changeTradingPair('BTC/USDT')" class="trading-pair-btn bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium">BTC/USDT</button>
                    <button onclick="changeTradingPair('ETH/USDT')" class="trading-pair-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium">ETH/USDT</button>
                    <button onclick="changeTradingPair('BNB/USDT')" class="trading-pair-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium">BNB/USDT</button>
                    <button onclick="changeTradingPair('ADA/USDT')" class="trading-pair-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md text-sm font-medium">ADA/USDT</button>
                </div>
            </div>

            <!-- 市场统计 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="metric-card rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">当前价格</p>
                            <p id="currentPrice" class="text-2xl font-bold text-gray-900 dark:text-white">$0.00</p>
                        </div>
                        <i data-lucide="trending-up" class="w-8 h-8 text-green-500"></i>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">24h 变化</p>
                            <p id="priceChange" class="text-2xl font-bold">+0.00%</p>
                            <p class="text-xs text-green-600 mt-1">做市商返佣 -0.05%</p>
                        </div>
                        <i data-lucide="activity" class="w-8 h-8 text-blue-500"></i>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">24h 最高</p>
                            <p id="high24h" class="text-2xl font-bold text-gray-900 dark:text-white">$0.00</p>
                        </div>
                        <i data-lucide="arrow-up" class="w-8 h-8 text-red-500"></i>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">24h 成交量</p>
                            <p id="volume24h" class="text-lg font-bold text-gray-900 dark:text-white">0.00</p>
                        </div>
                        <i data-lucide="bar-chart-3" class="w-8 h-8 text-purple-500"></i>
                    </div>
                </div>
            </div>

            <!-- 主要交易区域 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- K线图 -->
                <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <span id="chartTitle">BTC/USDT</span> K线图
                    </h3>
                    <div id="tradingChart" class="h-96 bg-gray-50 dark:bg-gray-700 rounded-lg relative overflow-hidden">
                        <!-- 运行时插入 canvas 或消息 -->
                    </div>
                </div>

                <!-- 订单表单 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <div class="flex space-x-2 mb-4">
                        <button onclick="showOrderType('buy')" class="order-type-btn bg-green-500 text-white px-4 py-2 rounded-md flex-1 text-sm font-medium">买入</button>
                        <button onclick="showOrderType('sell')" class="order-type-btn bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-md flex-1 text-sm font-medium">卖出</button>
                    </div>

                    <div id="buyForm" class="order-form">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">订单类型</label>
                                <select class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option>限价单</option>
                                    <option>市价单</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">价格 (USDT)</label>
                                <input type="number" placeholder="0.00" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">数量 (BTC)</label>
                                <input type="number" placeholder="0.00" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <button class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-md font-medium transition-colors">
                                买入 BTC
                            </button>
                        </div>
                    </div>

                    <div id="sellForm" class="order-form hidden">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">订单类型</label>
                                <select class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option>限价单</option>
                                    <option>市价单</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">价格 (USDT)</label>
                                <input type="number" placeholder="0.00" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">数量 (BTC)</label>
                                <input type="number" placeholder="0.00" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <button class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-md font-medium transition-colors">
                                卖出 BTC
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 订单簿和交易历史 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                <!-- 订单簿 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">订单簿</h3>
                    <div class="space-y-2">
                        <div class="grid grid-cols-3 gap-4 text-sm text-gray-500 dark:text-gray-400 font-medium">
                            <div>价格 (USDT)</div>
                            <div>数量 (BTC)</div>
                            <div>总额</div>
                        </div>
                        <div id="orderBookData" class="space-y-1">
                            <!-- 订单簿数据将在这里动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 交易历史 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">交易历史</h3>
                    <div class="space-y-2">
                        <div class="grid grid-cols-4 gap-4 text-sm text-gray-500 dark:text-gray-400 font-medium">
                            <div>时间</div>
                            <div>价格</div>
                            <div>数量</div>
                            <div>方向</div>
                        </div>
                        <div id="tradeHistoryData" class="space-y-1">
                            <!-- 交易历史数据将在这里动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 登录界面 -->
        <div id="login-tab" class="tab-content">
            <div class="min-h-screen flex items-center justify-center">
                <div class="max-w-md w-full space-y-8">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold text-gray-900 dark:text-white">登录您的账户</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">欢迎回到 CEX 交易所</p>
                    </div>
                    <form class="mt-8 space-y-6 bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg border">
                        <div class="space-y-4">
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">邮箱地址</label>
                                <input id="email" name="email" type="email" required 
                                       class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">密码</label>
                                <div class="relative mt-1">
                                    <input id="password" name="password" type="password" required 
                                           class="block w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <button type="button" onclick="togglePassword()" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                        <i data-lucide="eye" class="w-5 h-5 text-gray-400" id="eyeIcon"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="remember-me" class="ml-2 block text-sm text-gray-900 dark:text-gray-300">记住我</label>
                            </div>
                            <div class="text-sm">
                                <a href="#" class="font-medium text-blue-600 hover:text-blue-500">忘记密码？</a>
                            </div>
                        </div>

                        <div>
                            <button type="submit" onclick="handleLogin(event)" 
                                    class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                <i data-lucide="log-in" class="w-5 h-5 mr-2"></i>
                                登录
                            </button>
                        </div>

                        <div class="text-center">
                            <span class="text-sm text-gray-600 dark:text-gray-400">还没有账户？</span>
                            <a href="#" class="font-medium text-blue-600 hover:text-blue-500 ml-1">立即注册</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- KYC验证界面 -->
        <div id="kyc-tab" class="tab-content">
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white">身份验证 (KYC)</h2>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">完成身份验证以解锁所有功能</p>
                </div>

                <!-- 进度指示器 -->
                <div class="flex justify-center mb-8">
                    <div class="flex items-center space-x-4">
                        <div class="progress-step active w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-blue-600 text-white">1</div>
                        <div class="w-16 h-1 bg-gray-200 dark:bg-gray-700"></div>
                        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-500">2</div>
                        <div class="w-16 h-1 bg-gray-200 dark:bg-gray-700"></div>
                        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-500">3</div>
                        <div class="w-16 h-1 bg-gray-200 dark:bg-gray-700"></div>
                        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-500">4</div>
                        <div class="w-16 h-1 bg-gray-200 dark:bg-gray-700"></div>
                        <div class="progress-step w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-500">5</div>
                    </div>
                </div>

                <!-- KYC表单 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border p-8">
                    <!-- 步骤1: 个人信息 -->
                    <div id="kyc-step-1" class="kyc-step active">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">个人基本信息</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">姓名</label>
                                <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">出生日期</label>
                                <input type="date" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">国籍</label>
                                <select class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option>选择国家</option>
                                    <option>中国</option>
                                    <option>美国</option>
                                    <option>英国</option>
                                    <option>日本</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">电话号码</label>
                                <input type="tel" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end">
                            <button onclick="nextKycStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition-colors">下一步</button>
                        </div>
                    </div>

                    <!-- 步骤2: 身份证件 -->
                    <div id="kyc-step-2" class="kyc-step">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">身份证件上传</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">证件类型</label>
                                <select class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option>身份证</option>
                                    <option>护照</option>
                                    <option>驾驶证</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">证件正面</label>
                                <div class="file-upload-area p-8 rounded-lg text-center cursor-pointer">
                                    <i data-lucide="upload" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                    <p class="text-gray-600 dark:text-gray-400">点击或拖拽文件到此区域上传</p>
                                    <p class="text-sm text-gray-500 mt-2">支持 JPG, PNG 格式，文件大小不超过 10MB</p>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">证件反面</label>
                                <div class="file-upload-area p-8 rounded-lg text-center cursor-pointer">
                                    <i data-lucide="upload" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                    <p class="text-gray-600 dark:text-gray-400">点击或拖拽文件到此区域上传</p>
                                    <p class="text-sm text-gray-500 mt-2">支持 JPG, PNG 格式，文件大小不超过 10MB</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-between">
                            <button onclick="prevKycStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-3 rounded-md font-medium transition-colors">上一步</button>
                            <button onclick="nextKycStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition-colors">下一步</button>
                        </div>
                    </div>

                    <!-- 步骤3: 地址证明 -->
                    <div id="kyc-step-3" class="kyc-step">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">地址证明</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">详细地址</label>
                                <textarea rows="3" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">地址证明文件</label>
                                <p class="text-sm text-gray-500 mb-3">请上传3个月内的银行对账单、水电费账单或其他官方文件</p>
                                <div class="file-upload-area p-8 rounded-lg text-center cursor-pointer">
                                    <i data-lucide="file-text" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                    <p class="text-gray-600 dark:text-gray-400">点击或拖拽文件到此区域上传</p>
                                    <p class="text-sm text-gray-500 mt-2">支持 PDF, JPG, PNG 格式</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-between">
                            <button onclick="prevKycStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-3 rounded-md font-medium transition-colors">上一步</button>
                            <button onclick="nextKycStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition-colors">下一步</button>
                        </div>
                    </div>

                    <!-- 步骤4: 资金来源 -->
                    <div id="kyc-step-4" class="kyc-step">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">资金来源验证</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">职业</label>
                                <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">雇主/公司名称</label>
                                <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">年收入范围</label>
                                <select class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option>选择收入范围</option>
                                    <option>少于 $25,000</option>
                                    <option>$25,000 - $50,000</option>
                                    <option>$50,000 - $100,000</option>
                                    <option>$100,000 - $250,000</option>
                                    <option>超过 $250,000</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">资金来源</label>
                                <textarea rows="3" placeholder="请详细描述您的资金来源" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></textarea>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-between">
                            <button onclick="prevKycStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-3 rounded-md font-medium transition-colors">上一步</button>
                            <button onclick="nextKycStep()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition-colors">下一步</button>
                        </div>
                    </div>

                    <!-- 步骤5: 审核提交 -->
                    <div id="kyc-step-5" class="kyc-step">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">审核与提交</h3>
                        <div class="bg-blue-50 dark:bg-blue-900 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-medium text-blue-900 dark:text-blue-100 mb-4">提交前请确认</h4>
                            <ul class="space-y-2 text-blue-800 dark:text-blue-200">
                                <li class="flex items-center">
                                    <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                                    所有个人信息准确无误
                                </li>
                                <li class="flex items-center">
                                    <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                                    身份证件清晰可见
                                </li>
                                <li class="flex items-center">
                                    <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                                    地址证明有效
                                </li>
                                <li class="flex items-center">
                                    <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                                    资金来源信息完整
                                </li>
                            </ul>
                        </div>
                        <div class="bg-yellow-50 dark:bg-yellow-900 rounded-lg p-4 mb-6">
                            <p class="text-yellow-800 dark:text-yellow-200 text-sm">
                                <i data-lucide="clock" class="w-4 h-4 inline mr-2"></i>
                                审核时间：通常在1-3个工作日内完成，您将收到邮件通知
                            </p>
                        </div>
                        <div class="flex items-center mb-6">
                            <input type="checkbox" id="agreeTerms" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="agreeTerms" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                                我同意 <a href="#" class="text-blue-600 hover:underline">服务条款</a> 和 <a href="#" class="text-blue-600 hover:underline">隐私政策</a>
                            </label>
                        </div>
                        <div class="mt-6 flex justify-between">
                            <button onclick="prevKycStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-3 rounded-md font-medium transition-colors">上一步</button>
                            <button onclick="submitKyc()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
                                <i data-lucide="send" class="w-5 h-5 mr-2 inline"></i>
                                提交审核
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 用户中心 -->
        <div id="dashboard-tab" class="tab-content">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">用户交易中心</h2>
                <p class="text-gray-600 dark:text-gray-400">管理您的资产和交易活动</p>
            </div>

            <!-- 总览卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">总资产 (USDT)</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">$12,458.67</p>
                        </div>
                        <i data-lucide="wallet" class="w-8 h-8 text-blue-500"></i>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">24h 盈亏</p>
                            <p class="text-2xl font-bold text-green-600">+$247.32</p>
                        </div>
                        <i data-lucide="trending-up" class="w-8 h-8 text-green-500"></i>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">CEX 代币</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">1,250 CEX</p>
                        </div>
                        <i data-lucide="coins" class="w-8 h-8 text-purple-500"></i>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">质押收益 APY</p>
                            <p class="text-2xl font-bold text-yellow-600">12.5%</p>
                        </div>
                        <i data-lucide="percent" class="w-8 h-8 text-yellow-500"></i>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 资产分布 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">资产分布</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white text-xs font-bold">₿</div>
                                <div class="ml-3">
                                    <p class="font-medium text-gray-900 dark:text-white">Bitcoin</p>
                                    <p class="text-sm text-gray-500">0.234 BTC</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-gray-900 dark:text-white">$8,456.78</p>
                                <p class="text-sm text-green-600">+2.34%</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold">Ξ</div>
                                <div class="ml-3">
                                    <p class="font-medium text-gray-900 dark:text-white">Ethereum</p>
                                    <p class="text-sm text-gray-500">1.567 ETH</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-gray-900 dark:text-white">$3,245.89</p>
                                <p class="text-sm text-red-600">-1.23%</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold">$</div>
                                <div class="ml-3">
                                    <p class="font-medium text-gray-900 dark:text-white">USDT</p>
                                    <p class="text-sm text-gray-500">756.00 USDT</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-gray-900 dark:text-white">$756.00</p>
                                <p class="text-sm text-gray-500">0.00%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 交易历史 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">最近交易</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 border-l-4 border-green-500 bg-green-50 dark:bg-green-900 rounded-r-lg">
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">买入 BTC/USDT</p>
                                <p class="text-sm text-gray-500">2024-01-15 14:30</p>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-green-600">+0.01234 BTC</p>
                                <p class="text-sm text-gray-500">$456.78</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 border-l-4 border-red-500 bg-red-50 dark:bg-red-900 rounded-r-lg">
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">卖出 ETH/USDT</p>
                                <p class="text-sm text-gray-500">2024-01-15 10:15</p>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-red-600">-0.5 ETH</p>
                                <p class="text-sm text-gray-500">$1,234.56</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900 rounded-r-lg">
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">质押 CEX 代币</p>
                                <p class="text-sm text-gray-500">2024-01-14 16:45</p>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-blue-600">+500 CEX</p>
                                <p class="text-sm text-gray-500">质押中</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 快捷操作 -->
            <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">快捷操作</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button class="flex flex-col items-center p-4 bg-blue-50 dark:bg-blue-900 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-800 transition-colors">
                        <i data-lucide="arrow-down-to-line" class="w-8 h-8 text-blue-600 mb-2"></i>
                        <span class="text-sm font-medium text-blue-600">充值</span>
                    </button>
                    <button class="flex flex-col items-center p-4 bg-red-50 dark:bg-red-900 rounded-lg hover:bg-red-100 dark:hover:bg-red-800 transition-colors">
                        <i data-lucide="arrow-up-from-line" class="w-8 h-8 text-red-600 mb-2"></i>
                        <span class="text-sm font-medium text-red-600">提现</span>
                    </button>
                    <button class="flex flex-col items-center p-4 bg-green-50 dark:bg-green-900 rounded-lg hover:bg-green-100 dark:hover:bg-green-800 transition-colors">
                        <i data-lucide="arrow-left-right" class="w-8 h-8 text-green-600 mb-2"></i>
                        <span class="text-sm font-medium text-green-600">交易</span>
                    </button>
                    <button class="flex flex-col items-center p-4 bg-purple-50 dark:bg-purple-900 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-800 transition-colors">
                        <i data-lucide="piggy-bank" class="w-8 h-8 text-purple-600 mb-2"></i>
                        <span class="text-sm font-medium text-purple-600">质押</span>
                    </button>
                </div>
            </div>

            <!-- 安全提醒 -->
            <div class="mt-8 bg-yellow-50 dark:bg-yellow-900 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-4">安全提醒</h3>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i data-lucide="shield-check" class="w-5 h-5 text-green-600 mr-3"></i>
                            <span class="text-yellow-800 dark:text-yellow-200">KYC 验证</span>
                        </div>
                        <span class="text-green-600 font-medium">已完成</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i data-lucide="smartphone" class="w-5 h-5 text-orange-600 mr-3"></i>
                            <span class="text-yellow-800 dark:text-yellow-200">双因子认证 (2FA)</span>
                        </div>
                        <button class="text-blue-600 hover:underline">立即设置</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 管理员后台 -->
        <div id="admin-tab" class="tab-content">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">管理员后台</h2>
                <p class="text-gray-600 dark:text-gray-400">系统监控与合规管理</p>
            </div>

            <!-- 系统概览 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">活跃用户</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">12,456</p>
                        </div>
                        <i data-lucide="users" class="w-8 h-8 text-blue-500"></i>
                    </div>
                    <div class="mt-2">
                        <span class="text-green-600 text-sm">+5.2% 本周</span>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">24h 交易量</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white">$2.4M</p>
                        </div>
                        <i data-lucide="bar-chart-3" class="w-8 h-8 text-green-500"></i>
                    </div>
                    <div class="mt-2">
                        <span class="text-green-600 text-sm">+12.8% 昨日</span>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">待审 KYC</p>
                            <p class="text-2xl font-bold text-orange-600">23</p>
                        </div>
                        <i data-lucide="file-check" class="w-8 h-8 text-orange-500"></i>
                    </div>
                    <div class="mt-2">
                        <span class="text-orange-600 text-sm">需要处理</span>
                    </div>
                </div>
                <div class="metric-card rounded-lg p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400">AML 告警</p>
                            <p class="text-2xl font-bold text-red-600">3</p>
                        </div>
                        <i data-lucide="alert-triangle" class="w-8 h-8 text-red-500"></i>
                    </div>
                    <div class="mt-2">
                        <span class="text-red-600 text-sm">高优先级</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- 实时活动监控 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">实时系统活动</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-green-500 rounded-full mr-3 trade-animation"></div>
                                <span class="text-gray-900 dark:text-white">用户 john.doe 完成 KYC 验证</span>
                            </div>
                            <span class="text-sm text-gray-500">刚刚</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mr-3 trade-animation"></div>
                                <span class="text-gray-900 dark:text-white">大额交易: 50 BTC → USDT</span>
                            </div>
                            <span class="text-sm text-gray-500">2分钟前</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full mr-3 trade-animation"></div>
                                <span class="text-gray-900 dark:text-white">系统维护: 钱包服务重启</span>
                            </div>
                            <span class="text-sm text-gray-500">5分钟前</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-red-500 rounded-full mr-3 trade-animation"></div>
                                <span class="text-gray-900 dark:text-white">AML 警告: 可疑交易模式检测</span>
                            </div>
                            <span class="text-sm text-gray-500">10分钟前</span>
                        </div>
                    </div>
                </div>

                <!-- 用户风险分布 -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">用户风险分布</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-green-500 rounded mr-3"></div>
                                <span class="text-gray-900 dark:text-white">低风险</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-600 dark:text-gray-400 mr-3">8,234 用户</span>
                                <span class="text-green-600 font-medium">66.1%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-yellow-500 rounded mr-3"></div>
                                <span class="text-gray-900 dark:text-white">中等风险</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-600 dark:text-gray-400 mr-3">3,891 用户</span>
                                <span class="text-yellow-600 font-medium">31.2%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-4 h-4 bg-red-500 rounded mr-3"></div>
                                <span class="text-gray-900 dark:text-white">高风险</span>
                            </div>
                            <div class="flex items-center">
                                <span class="text-gray-600 dark:text-gray-400 mr-3">331 用户</span>
                                <span class="text-red-600 font-medium">2.7%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 用户管理 -->
            <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">用户管理</h3>
                    <div class="flex space-x-3">
                        <input type="text" placeholder="搜索用户..." class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <select class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option>所有状态</option>
                            <option>已验证</option>
                            <option>待验证</option>
                            <option>已拒绝</option>
                        </select>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead class="bg-gray-50 dark:bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">用户</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">KYC状态</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">风险等级</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">注册时间</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">操作</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            <div class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium">JD</div>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white">john.doe@email.com</div>
                                            <div class="text-sm text-gray-500">ID: 12345</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">已验证</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">低风险</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">2024-01-10</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-blue-600 hover:text-blue-900 mr-3">查看</button>
                                    <button class="text-red-600 hover:text-red-900">冻结</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            <div class="h-10 w-10 rounded-full bg-purple-500 flex items-center justify-center text-white font-medium">AS</div>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white">alice.smith@email.com</div>
                                            <div class="text-sm text-gray-500">ID: 12346</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">待审核</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">中等风险</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">2024-01-12</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-blue-600 hover:text-blue-900 mr-3">审核</button>
                                    <button class="text-gray-600 hover:text-gray-900">查看</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 合规审核 -->
            <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-sm border p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">合规审核中心</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 待审 KYC -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 dark:text-white mb-4">待审核 KYC 申请</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">alice.smith@email.com</p>
                                    <p class="text-sm text-gray-500">提交时间: 2024-01-15 09:30</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">通过</button>
                                    <button class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">拒绝</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">bob.wilson@email.com</p>
                                    <p class="text-sm text-gray-500">提交时间: 2024-01-15 11:45</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">通过</button>
                                    <button class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">拒绝</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AML 警告 -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 dark:text-white mb-4">AML 风险警告</h4>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">高频大额交易</p>
                                    <p class="text-sm text-gray-500">用户: trader123 (ID: 45678)</p>
                                    <p class="text-sm text-red-600">24h内交易 $500K+</p>
                                </div>
                                <button class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">调查</button>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900 dark:text-white">异常地理位置</p>
                                    <p class="text-sm text-gray-500">用户: globaluser (ID: 78901)</p>
                                    <p class="text-sm text-orange-600">短时间内多国登录</p>
                                </div>
                                <button class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm">审查</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化 Lucide 图标
        lucide.createIcons();

        // 全局变量
        let currentTradingPair = 'BTC/USDT';
        let currentKycStep = 1;
        let marketData = {};
        let orderBookData = [];
        let tradeHistoryData = [];

        // 主题切换
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.contains('dark');
            
            if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // 初始化主题
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            }
        }

        // 标签页切换
        function showTab(tabName) {
            // 隐藏所有标签页
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 显示选中的标签页
            const activeTab = document.getElementById(tabName + '-tab');
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // 更新导航链接状态
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('text-blue-600');
                link.classList.add('text-gray-500', 'hover:text-gray-700', 'dark:text-gray-300');
            });
            
            // 设置当前活跃链接
            event.target.classList.remove('text-gray-500', 'hover:text-gray-700', 'dark:text-gray-300');
            event.target.classList.add('text-blue-600');
        }

        // 交易对切换
        function changeTradingPair(pair) {
            currentTradingPair = pair;
            
            // 更新交易对按钮状态
            const buttons = document.querySelectorAll('.trading-pair-btn');
            buttons.forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            });
            
            event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            event.target.classList.add('bg-blue-500', 'text-white');
            
            // 更新图表标题
            document.getElementById('chartTitle').textContent = pair;
            
            // 持久化选择
            try { localStorage.setItem('preferred_pair', pair); } catch {}

            // 切换时刷新该交易对的24h统计，并重订阅WS
            (async () => {
                const d = await fetchMarketDataForPair(currentTradingPair);
                Object.assign(marketData, d);
                updateMarketData();
                subscribeToBinanceStreams(currentTradingPair);
            })();
        }

        // 订单类型切换
        function showOrderType(type) {
            const buyForm = document.getElementById('buyForm');
            const sellForm = document.getElementById('sellForm');
            const buttons = document.querySelectorAll('.order-type-btn');
            
            buttons.forEach(btn => {
                btn.classList.remove('bg-green-500', 'bg-red-500', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            });
            
            if (type === 'buy') {
                buyForm.classList.remove('hidden');
                sellForm.classList.add('hidden');
                event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                event.target.classList.add('bg-green-500', 'text-white');
            } else {
                sellForm.classList.remove('hidden');
                buyForm.classList.add('hidden');
                event.target.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                event.target.classList.add('bg-red-500', 'text-white');
            }
        }

        // 密码可见性切换
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                eyeIcon.setAttribute('data-lucide', 'eye');
            }
            
            lucide.createIcons();
        }

        // 登录处理
        function handleLogin(event) {
            event.preventDefault();
            alert('登录功能演示 - 在实际系统中会进行身份验证');
        }

        // KYC步骤导航
        function nextKycStep() {
            if (currentKycStep < 5) {
                document.getElementById(`kyc-step-${currentKycStep}`).classList.remove('active');
                document.querySelectorAll('.progress-step')[currentKycStep - 1].classList.remove('active');
                
                currentKycStep++;
                
                document.getElementById(`kyc-step-${currentKycStep}`).classList.add('active');
                document.querySelectorAll('.progress-step')[currentKycStep - 1].classList.add('active');
            }
        }

        function prevKycStep() {
            if (currentKycStep > 1) {
                document.getElementById(`kyc-step-${currentKycStep}`).classList.remove('active');
                document.querySelectorAll('.progress-step')[currentKycStep - 1].classList.remove('active');
                
                currentKycStep--;
                
                document.getElementById(`kyc-step-${currentKycStep}`).classList.add('active');
                document.querySelectorAll('.progress-step')[currentKycStep - 1].classList.add('active');
            }
        }

        function submitKyc() {
            const agreeTerms = document.getElementById('agreeTerms').checked;
            if (!agreeTerms) {
                alert('请先同意服务条款和隐私政策');
                return;
            }
            
            alert('KYC申请已提交！我们将在1-3个工作日内完成审核。');
        }

        // 获取真实市场数据
        async function fetchMarketDataForPair(pair) {
            const symbolMap = {
                'BTC/USDT': 'BTCUSDT',
                'ETH/USDT': 'ETHUSDT',
                'BNB/USDT': 'BNBUSDT',
                'ADA/USDT': 'ADAUSDT'
            };
            const cgIdMap = {
                'BTC/USDT': 'bitcoin',
                'ETH/USDT': 'ethereum',
                'BNB/USDT': 'binancecoin',
                'ADA/USDT': 'cardano'
            };

            const symbol = symbolMap[pair];
            try {
                const res = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                if (res.ok) {
                    const t = await res.json();
                    updateDataSourceBanner('Binance', 'success');
                    const processed = {};
                    processed[pair] = {
                        price: parseFloat(t.lastPrice),
                        change24h: parseFloat(t.priceChangePercent),
                        high24h: parseFloat(t.highPrice),
                        low24h: parseFloat(t.lowPrice),
                        volume24h: parseFloat(t.volume)
                    };
                    return processed;
                }
            } catch (e) {
                console.log('Binance API 不可用，尝试 CoinGecko...');
            }

            try {
                const id = cgIdMap[pair];
                const cgRes = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${id}&vs_currencies=usd&include_24hr_change=true`);
                if (cgRes.ok) {
                    const d = await cgRes.json();
                    updateDataSourceBanner('CoinGecko', 'fallback');
                    const processed = {};
                    processed[pair] = {
                        price: d[id].usd,
                        change24h: d[id].usd_24h_change,
                        high24h: d[id].usd * 1.0, // 无法可靠获取，避免伪造，保持等于价
                        low24h: d[id].usd * 1.0,
                        volume24h: null
                    };
                    return processed;
                }
            } catch (e) {
                console.log('CoinGecko API 不可用');
            }

            updateDataSourceBanner('离线模式', 'offline');
            return {}; // 不返回演示数据，避免伪造
        }

        function processBinanceData(data) {
            const symbols = {
                'BTCUSDT': 'BTC/USDT',
                'ETHUSDT': 'ETH/USDT',
                'BNBUSDT': 'BNB/USDT',
                'ADAUSDT': 'ADA/USDT'
            };

            const processedData = {};
            
            data.forEach(item => {
                if (symbols[item.symbol]) {
                    processedData[symbols[item.symbol]] = {
                        price: parseFloat(item.lastPrice),
                        change24h: parseFloat(item.priceChangePercent),
                        high24h: parseFloat(item.highPrice),
                        low24h: parseFloat(item.lowPrice),
                        volume24h: parseFloat(item.volume)
                    };
                }
            });

            return processedData;
        }

        function processCoinGeckoData(data) {
            return {
                'BTC/USDT': {
                    price: data.bitcoin.usd,
                    change24h: data.bitcoin.usd_24h_change,
                    high24h: data.bitcoin.usd * 1.05,
                    low24h: data.bitcoin.usd * 0.95,
                    volume24h: 25000
                },
                'ETH/USDT': {
                    price: data.ethereum.usd,
                    change24h: data.ethereum.usd_24h_change,
                    high24h: data.ethereum.usd * 1.05,
                    low24h: data.ethereum.usd * 0.95,
                    volume24h: 15000
                },
                'BNB/USDT': {
                    price: data.binancecoin.usd,
                    change24h: data.binancecoin.usd_24h_change,
                    high24h: data.binancecoin.usd * 1.05,
                    low24h: data.binancecoin.usd * 0.95,
                    volume24h: 8000
                },
                'ADA/USDT': {
                    price: data.cardano.usd,
                    change24h: data.cardano.usd_24h_change,
                    high24h: data.cardano.usd * 1.05,
                    low24h: data.cardano.usd * 0.95,
                    volume24h: 12000
                }
            };
        }

        function getDefaultMarketData() {
            return {}; // 不返回任何默认值，严格避免伪造
        }

        function updateDataSourceBanner(source, status) {
            const banner = document.getElementById('dataSourceBanner');
            const text = document.getElementById('dataSourceText');
            const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            
            banner.className = 'text-white text-center py-2 text-sm';
            
            switch (status) {
                case 'success':
                    banner.classList.add('bg-green-600');
                    text.textContent = `数据源: ${source} API (实时数据) · 最后更新 ${time}`;
                    break;
                case 'fallback':
                    banner.classList.add('bg-yellow-600');
                    text.textContent = `数据源: ${source} API (备用数据源) · 最后更新 ${time}`;
                    break;
                case 'offline':
                    banner.classList.add('bg-gray-600');
                    text.textContent = `数据源: ${source} (无数据)`;
                    break;
                default:
                    banner.classList.add('bg-blue-600');
                    text.textContent = '数据源: 正在连接...';
            }
        }

        // 错误提示层
        function showToast(message, type = 'error') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const id = 'toast_' + Date.now();
            const bg = type === 'error' ? 'bg-red-600' : type === 'warn' ? 'bg-yellow-600' : 'bg-blue-600';
            const el = document.createElement('div');
            el.id = id;
            el.className = `${bg} text-white px-4 py-3 rounded shadow`;
            el.textContent = message;
            container.appendChild(el);
            setTimeout(() => {
                const t = document.getElementById(id);
                if (t && t.parentNode) t.parentNode.removeChild(t);
            }, 5000);
        }

        // 更新市场数据显示
        function updateMarketData() {
            const data = marketData[currentTradingPair];
            const priceEl = document.getElementById('currentPrice');
            const changeEl = document.getElementById('priceChange');
            const highEl = document.getElementById('high24h');
            const volEl = document.getElementById('volume24h');

            if (!data || data.price == null) {
                priceEl.textContent = 'N/A';
                changeEl.textContent = 'N/A';
                changeEl.className = 'text-2xl font-bold text-gray-500';
                highEl.textContent = 'N/A';
                volEl.textContent = 'N/A';
                return;
            }

            priceEl.textContent = `$${Number(data.price).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;

            if (data.change24h == null || isNaN(data.change24h)) {
                changeEl.textContent = 'N/A';
                changeEl.className = 'text-2xl font-bold text-gray-500';
            } else {
                const changeText = `${data.change24h >= 0 ? '+' : ''}${data.change24h.toFixed(2)}%`;
                changeEl.textContent = changeText;
                changeEl.className = `text-2xl font-bold ${data.change24h >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }

            highEl.textContent = data.high24h == null ? 'N/A' : `$${Number(data.high24h).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            volEl.textContent = data.volume24h == null ? 'N/A' : `${Number(data.volume24h).toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
        }

        // 生成模拟订单簿数据
        // 使用深度数据渲染订单簿（不使用任何随机数据）
        function renderOrderBookFromDepth(bids, asks, lastPrice) {
            const orderBookContainer = document.getElementById('orderBookData');
            if (!orderBookContainer) return;

            let html = '';

            const fmt = (v) => Number(v).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 8 });

            // 卖单（红色，价格由低到高显示，顶部接近中间价）
            const topAsks = (asks || []).slice(0, 5).map(([p, q]) => ({ p: parseFloat(p), q: parseFloat(q) }));
            topAsks.sort((a, b) => a.p - b.p);
            topAsks.forEach(level => {
                const total = level.p * level.q;
                html += `
                    <div class="grid grid-cols-3 gap-4 text-sm py-1">
                        <div class="text-red-600">${fmt(level.p)}</div>
                        <div class="text-gray-900 dark:text-white">${level.q.toFixed(6)}</div>
                        <div class="text-gray-600 dark:text-gray-400">${fmt(total)}</div>
                    </div>
                `;
            });

            // 当前价
            const mid = lastPrice != null ? fmt(lastPrice) : 'N/A';
            html += `
                <div class="grid grid-cols-3 gap-4 text-sm py-2 border-y border-gray-200 dark:border-gray-700">
                    <div class="col-span-3 text-center font-bold text-lg text-gray-900 dark:text-white">${mid}</div>
                </div>
            `;

            // 买单（绿色，价格由高到低显示）
            const topBids = (bids || []).slice(0, 5).map(([p, q]) => ({ p: parseFloat(p), q: parseFloat(q) }));
            topBids.sort((a, b) => b.p - a.p);
            topBids.forEach(level => {
                const total = level.p * level.q;
                html += `
                    <div class="grid grid-cols-3 gap-4 text-sm py-1">
                        <div class="text-green-600">${fmt(level.p)}</div>
                        <div class="text-gray-900 dark:text-white">${level.q.toFixed(6)}</div>
                        <div class="text-gray-600 dark:text-gray-400">${fmt(total)}</div>
                    </div>
                `;
            });

            orderBookContainer.innerHTML = html;
        }

        // 生成模拟交易历史
        // 使用真实成交数据渲染成交历史
        function renderTradeHistory() {
            const tradeHistoryContainer = document.getElementById('tradeHistoryData');
            if (!tradeHistoryContainer) return;

            let html = '';
            tradeHistoryData.slice(0, 20).forEach(t => {
                const time = new Date(t.time).toLocaleTimeString('zh-CN', { hour12: false });
                html += `
                    <div class="grid grid-cols-4 gap-4 text-sm py-1">
                        <div class="text-gray-600 dark:text-gray-400">${time}</div>
                        <div class="text-gray-900 dark:text-white">${t.price.toFixed(2)}</div>
                        <div class="text-gray-900 dark:text-white">${t.qty.toFixed(6)}</div>
                        <div class="${t.side === 'buy' ? 'text-green-600' : 'text-red-600'}">${t.side === 'buy' ? '买入' : '卖出'}</div>
                    </div>
                `;
            });

            tradeHistoryContainer.innerHTML = html;
        }

        // 初始化应用
        // Binance 实时数据订阅
        let tradeWs = null;
        let depthWs = null;
        let lastTradePrice = null;
        let wsRetry = { trade: 0, depth: 0 };
        let lastUpdateAt = 0;
        let staleTimer = null;

        function pairToBinanceSymbol(pair) {
            return pair.toLowerCase().replace('/', '')
        }

        // 拉取并渲染真实K线（如遭遇CORS/429，显示明确提示）
        async function renderKlines(pair) {
            const chart = document.getElementById('tradingChart');
            if (!chart) return;
            chart.innerHTML = '';
            const canvas = document.createElement('canvas');
            canvas.width = chart.clientWidth;
            canvas.height = chart.clientHeight;
            chart.appendChild(canvas);
            const ctx = canvas.getContext('2d');

            const symbol = pairToBinanceSymbol(pair).toUpperCase();
            const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&limit=100`;
            let data;
            try {
                const res = await fetch(url);
                if (!res.ok) {
                    if (res.status === 429) showToast('Binance 限流 (429)：请稍后重试。', 'warn');
                    else showToast(`无法获取K线: HTTP ${res.status}`, 'error');
                    showKlineUnavailable(chart);
                    return;
                }
                data = await res.json();
            } catch (e) {
                showToast('网络错误：获取K线失败', 'error');
                showKlineUnavailable(chart);
                return;
            }

            if (!Array.isArray(data) || data.length === 0) {
                showKlineUnavailable(chart);
                return;
            }

            // 解析蜡烛
            const candles = data.map(k => ({
                openTime: k[0], open: +k[1], high: +k[2], low: +k[3], close: +k[4]
            }));
            const highs = candles.map(c => c.high);
            const lows = candles.map(c => c.low);
            const maxP = Math.max(...highs);
            const minP = Math.min(...lows);
            const pad = 10;
            const w = canvas.width, h = canvas.height;
            const gridH = h - pad * 2;
            const gridW = w - pad * 2;

            // 背景网格
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad + (i / 4) * gridH;
                ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(pad + gridW, y); ctx.stroke();
            }

            const xStep = gridW / candles.length;
            candles.forEach((c, idx) => {
                const x = pad + idx * xStep + xStep / 2;
                const y = p => pad + (1 - (p - minP) / (maxP - minP)) * gridH;
                const openY = y(c.open), closeY = y(c.close), highY = y(c.high), lowY = y(c.low);
                const up = c.close >= c.open;
                ctx.strokeStyle = up ? '#16a34a' : '#dc2626';
                ctx.fillStyle = up ? '#16a34a' : '#dc2626';
                // wick
                ctx.beginPath(); ctx.moveTo(x, highY); ctx.lineTo(x, lowY); ctx.stroke();
                // body
                const bodyTop = Math.min(openY, closeY);
                const bodyH = Math.max(1, Math.abs(closeY - openY));
                ctx.fillRect(x - 2, bodyTop, 4, bodyH);
            });
        }

        function showKlineUnavailable(chartEl) {
            const msg = document.createElement('div');
            msg.className = 'absolute inset-0 flex items-center justify-center text-sm text-gray-500';
            msg.textContent = 'K线数据暂不可用（CORS/限流/网络），不展示模拟图表。';
            chartEl.appendChild(msg);
        }

        function cleanupBinanceStreams() {
            try { if (tradeWs) { tradeWs.close(); tradeWs = null; } } catch {}
            try { if (depthWs) { depthWs.close(); depthWs = null; } } catch {}
            wsRetry = { trade: 0, depth: 0 };
            if (staleTimer) { clearInterval(staleTimer); staleTimer = null; }
        }

        function subscribeToBinanceStreams(pair) {
            cleanupBinanceStreams();
            const sym = pairToBinanceSymbol(pair);

            // 成交流
            tradeWs = new WebSocket(`wss://stream.binance.com:9443/ws/${sym}@trade`);
            tradeWs.onmessage = (ev) => {
                try {
                    const d = JSON.parse(ev.data);
                    const price = parseFloat(d.p);
                    const qty = parseFloat(d.q);
                    const isBuyerMaker = d.m; // true 表示卖出主动方
                    lastTradePrice = price;
                    lastUpdateAt = Date.now();

                    // 更新价格显示（不等待ticker）
                    if (!marketData[currentTradingPair]) marketData[currentTradingPair] = {};
                    marketData[currentTradingPair].price = price;
                    updateMarketData();

                    // 累积成交历史
                    tradeHistoryData.unshift({ price, qty, side: isBuyerMaker ? 'sell' : 'buy', time: d.T });
                    if (tradeHistoryData.length > 50) tradeHistoryData.length = 50;
                    renderTradeHistory();
                } catch {}
            };
            tradeWs.onclose = () => {
                const delay = Math.min(30000, 1000 * Math.pow(2, wsRetry.trade++));
                setTimeout(() => subscribeToBinanceStreams(currentTradingPair), delay);
            };

            // 深度前5档
            depthWs = new WebSocket(`wss://stream.binance.com:9443/ws/${sym}@depth5@100ms`);
            depthWs.onmessage = (ev) => {
                try {
                    const d = JSON.parse(ev.data);
                    lastUpdateAt = Date.now();
                    renderOrderBookFromDepth(d.b, d.a, lastTradePrice || (marketData[currentTradingPair] && marketData[currentTradingPair].price));
                } catch {}
            };
            depthWs.onclose = () => {
                const delay = Math.min(30000, 1000 * Math.pow(2, wsRetry.depth++));
                setTimeout(() => subscribeToBinanceStreams(currentTradingPair), delay);
            };

            // 启动“数据过期”检测
            if (staleTimer) clearInterval(staleTimer);
            staleTimer = setInterval(() => {
                const banner = document.getElementById('dataSourceBanner');
                const text = document.getElementById('dataSourceText');
                if (!banner || !text) return;
                const diff = Date.now() - lastUpdateAt;
                if (diff > 15000) { // 超过15秒无更新，标记为过期
                    banner.className = 'bg-yellow-700 text-white text-center py-2 text-sm';
                    text.textContent = '数据源: 连接不稳定或数据过期';
                }
            }, 5000);
        }

        async function initApp() {
            initTheme();
            // 恢复交易对偏好
            try {
                const pref = localStorage.getItem('preferred_pair');
                if (pref) {
                    currentTradingPair = pref;
                    const title = document.getElementById('chartTitle');
                    if (title) title.textContent = pref;
                }
            } catch {}
            
            // 恢复交易对偏好
            try {
                const pref = localStorage.getItem('preferred_pair');
                if (pref) {
                    currentTradingPair = pref;
                    const title = document.getElementById('chartTitle');
                    if (title) title.textContent = pref;
                }
            } catch {}

            // 获取市场数据
            marketData = await fetchMarketDataForPair(currentTradingPair);
            
            // 更新UI
            updateMarketData();
            renderTradeHistory();
            subscribeToBinanceStreams(currentTradingPair);
            renderKlines(currentTradingPair);
            
            // 设置定时更新
            setInterval(async () => {
                const d = await fetchMarketDataForPair(currentTradingPair);
                Object.assign(marketData, d);
                updateMarketData();
            }, 30000); // 30秒更新一次24h统计
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
